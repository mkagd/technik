# ๐ FLOW BLOKADY KONTA - WIZUALIZACJA

## ๐ POPRZEDNI FLOW (ลนLE)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. Pracownik prรณbuje siฤ zalogowaฤ                              โ
โ    Email: jan.kowalski@techserwis.pl                            โ
โ    Password: zlehaslo123                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. API sprawdza email โ โ OK                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. API sprawdza hasลo z bcrypt                                  โ
โ    bcrypt.compare("zlehaslo123", passwordHash) โ โ FALSE       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. Zwiฤksz failedLoginAttempts                                  โ
โ    employee.failedLoginAttempts++ โ 1                           โ
โ    saveEmployees(employees) โ zapisane                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. โ BลฤD: Reset licznika (ZA WCZEลNIE!)                       โ
โ    employee.failedLoginAttempts = 0 โ ลนLE!                     โ
โ    saveEmployees(employees)                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6. Sprawdลบ isLocked (ZA PรลนNO!)                                 โ
โ    if (employee.isLocked) โ FALSE                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 7. Return error                                                 โ
โ    { message: "Nieprawidลowe hasลo. Pozostaลo prรณb: 5" }       โ
โ    โ POKAZUJE 5, BO LICZNIK ZOSTAล ZRESETOWANY!                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ PROBLEM: Licznik zawsze = 0, wiฤc admin panel pokazuje "0 / 5"
```

---

## โ NOWY FLOW (DOBRZE)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. Pracownik prรณbuje siฤ zalogowaฤ                              โ
โ    Email: jan.kowalski@techserwis.pl                            โ
โ    Password: zlehaslo123                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. API sprawdza email โ โ OK                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. โ NAJPIERW: Sprawdลบ czy konto zablokowane                   โ
โ    if (employee.isLocked) โ FALSE (nie zablokowane)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. Sprawdลบ hasลo z bcrypt                                       โ
โ    bcrypt.compare("zlehaslo123", passwordHash) โ โ FALSE       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. Zwiฤksz failedLoginAttempts                                  โ
โ    employee.failedLoginAttempts++ โ 1                           โ
โ    employee.lastLoginAttempt = "2025-10-04T10:30:00.000Z"      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6. Sprawdลบ czy osiฤgniฤto limit (5 prรณb)                        โ
โ    if (failedLoginAttempts >= 5) โ FALSE (dopiero 1)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 7. Zapisz stan                                                  โ
โ    saveEmployees(employees) โ zapisane z failedLoginAttempts=1  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 8. Return error                                                 โ
โ    { message: "โ Nieprawidลowe hasลo. Pozostaลo prรณb: 4." }   โ
โ    โ PRAWIDลOWO POKAZUJE 4 (5 - 1 = 4)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ DZIAลA: Admin panel pokazuje "1 / 5"
```

---

## ๐ด FLOW: 5 NIEUDANYCH PRรB (AUTOMATYCZNA BLOKADA)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Prรณba #1: zlehaslo โ failedLoginAttempts = 1                   โ
โ           โ "Nieprawidลowe hasลo. Pozostaลo prรณb: 4."         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Prรณba #2: zlehaslo โ failedLoginAttempts = 2                   โ
โ           โ "Nieprawidลowe hasลo. Pozostaลo prรณb: 3."         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Prรณba #3: zlehaslo โ failedLoginAttempts = 3                   โ
โ           โ "Nieprawidลowe hasลo. Pozostaลo prรณb: 2."         โ
โ           โ๏ธ Admin panel pokazuje: "3 / 5" (OSTRZEลปENIE!)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Prรณba #4: zlehaslo โ failedLoginAttempts = 4                   โ
โ           โ "Nieprawidลowe hasลo. Pozostaลo prรณb: 1."         โ
โ           โ๏ธ Admin panel pokazuje: "4 / 5" (OSTATNIA SZANSA!)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Prรณba #5: zlehaslo โ failedLoginAttempts = 5                   โ
โ           if (failedLoginAttempts >= 5) โ TRUE                  โ
โ           employee.isLocked = true                              โ
โ           employee.lockedAt = "2025-10-04T10:35:00.000Z"       โ
โ           employee.lockReason = 'automatic'                     โ
โ           saveEmployees(employees)                              โ
โ           โ "๐ Twoje konto zostaลo zablokowane z powodu zbyt โ
โ               wielu nieudanych prรณb logowania. Skontaktuj siฤ   โ
โ               z administratorem."                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Admin panel (SecurityTab):                                      โ
โ   - Status konta: ๐ ZABLOKOWANE                                โ
โ   - Nieudane prรณby: 5 / 5                                       โ
โ   - Zablokowane przez: System (automatic)                       โ
โ   - Zablokowane o: 2025-10-04 10:35                             โ
โ   - Przycisk: "Odblokuj konto" (zielony)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ FLOW: PRรBA LOGOWANIA PO ZABLOKOWANIU

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. Zablokowany pracownik prรณbuje siฤ zalogowaฤ                  โ
โ    Email: jan.kowalski@techserwis.pl                            โ
โ    Password: PRAWIDLOWE_HASLO (nawet dobre hasลo!)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. API sprawdza email โ โ OK                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. โ KROK 1: Sprawdลบ czy konto zablokowane (PRZED hasลem!)    โ
โ    if (employee.isLocked) โ TRUE                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. โ KONIEC - Return error (NIE SPRAWDZA HASลA!)               โ
โ    {                                                            โ
โ      success: false,                                            โ
โ      message: "๐ Twoje konto zostaลo zablokowane/zawieszone.  โ
โ                Skontaktuj siฤ z administratorem, aby je         โ
โ                odblokowaฤ.",                                    โ
โ      isLocked: true                                             โ
โ    }                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ BEZPIECZEลSTWO: Hasลo NIE jest sprawdzane, bo konto jest zablokowane!
   To zapobiega atakom brute-force na zablokowane konta.
```

---

## ๐ FLOW: ODBLOKOWANIE PRZEZ ADMINA

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. Admin otwiera panel: Pracownicy โ Jan Kowalski โ Security   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. Admin widzi:                                                 โ
โ    - Status konta: ๐ ZABLOKOWANE (czerwone)                    โ
โ    - Nieudane prรณby: 5 / 5                                      โ
โ    - Przycisk: "Odblokuj konto" (zielony)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. Admin klika "Odblokuj konto"                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. Frontend wysyลa request:                                     โ
โ    POST /api/admin/employee-password                            โ
โ    {                                                            โ
โ      action: 'unlock',                                          โ
โ      employeeId: 'EMP25189001',                                 โ
โ      adminId: 'ADMIN001'                                        โ
โ    }                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. API resetuje:                                                โ
โ    employee.isLocked = false                                    โ
โ    employee.failedLoginAttempts = 0                             โ
โ    employee.unlockedBy = 'ADMIN001'                             โ
โ    employee.unlockedAt = '2025-10-04T10:40:00.000Z'            โ
โ    saveEmployees(employees)                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6. Admin widzi:                                                 โ
โ    โ "Konto zostaลo odblokowane"                               โ
โ    - Status konta: โ AKTYWNE (zielone)                         โ
โ    - Nieudane prรณby: 0 / 5                                      โ
โ    - Przycisk: "Zablokuj konto" (czerwony)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 7. Pracownik moลผe siฤ teraz zalogowaฤ normalnie:                โ
โ    Email: jan.kowalski@techserwis.pl                            โ
โ    Password: PRAWIDLOWE_HASLO                                   โ
โ    โ โ "Zalogowano pomyลlnie"                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ KLUCZOWE ZMIANY

| Co | Przed | Po |
|----|-------|-----|
| **Kolejnoลฤ sprawdzania** | 1. Hasลo<br>2. isLocked | 1. isLocked<br>2. Hasลo |
| **Reset licznika** | Po sprawdzeniu hasลa (zawsze) | Tylko przy udanym logowaniu |
| **Zapis licznika** | Przed return (ale po resecie) | Natychmiast po zwiฤkszeniu |
| **Komunikat dla pracownika** | "Konto jest zablokowane" | "๐ Twoje konto zostaลo zablokowane/zawieszone" |
| **Dane przy blokadzie** | `isLocked = true` | `isLocked = true`<br>`lockedAt = timestamp`<br>`lockReason = 'automatic'` |

---

โ **WSZYSTKO DZIAลA PRAWIDลOWO!**

