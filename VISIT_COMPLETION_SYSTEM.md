# üéØ System Ko≈Ñczenia Wizyt - Propozycja Implementacji

## üìã Obecny Stan

### ‚úÖ Co dzia≈Ça:
1. **StatusControl** - przycisk "Zako≈Ñczona" zmienia status na `completed`
2. **API /update-status** - automatycznie:
   - Zamyka sesje pracy
   - Oblicza ca≈Çkowity czas
   - Zapisuje czas zako≈Ñczenia
   - Aktualizuje status zlecenia (je≈õli to ostatnia wizyta)

### ‚ùå Czego brakuje:
1. **Walidacja kompletno≈õci** - nie sprawdza czy wszystko wype≈Çnione
2. **Protok√≥≈Ç zako≈Ñczenia** - brak struktury podsumowania
3. **Wymagane dane** - brak wymuszenia kluczowych informacji
4. **Zdjƒôcia "po"** - nie ma wymogu zdjƒôƒá efektu pracy
5. **Podsumowanie koszt√≥w** - brak kalkulacji ko≈Ñcowych
6. **Potwierdzenie klienta** - brak podpisu/akceptacji

---

## üéØ Proponowane RozwiƒÖzanie

### **Opcja A: Minimalistyczna (POLECAM) ‚≠ê**
**Szybka do implementacji, nie blokuje workflow**

#### Co dodaƒá:
1. **Modal podsumowania** przed zmianƒÖ statusu na "completed"
2. **Quick checklist:**
   - ‚òê Czy wykonano naprawƒô?
   - ‚òê Czy dzia≈Ça urzƒÖdzenie?
   - ‚òê Czy zrobiono zdjƒôcia po naprawie?
   - ‚òê Czy u≈ºyto jakich≈õ czƒô≈õci?

3. **Minimum required:**
   - Kr√≥tka notatka o wykonanej pracy (1-2 zdania)
   - Przynajmniej 1 zdjƒôcie "po"

#### Przep≈Çyw:
```
[Przycisk "Zako≈Ñczona"]
    ‚Üì
[Modal: Quick Summary]
‚îú‚îÄ‚îÄ Textarea: Co zrobiono? (REQUIRED)
‚îú‚îÄ‚îÄ Status urzƒÖdzenia: [Sprawne ‚úÖ / Wymaga czƒô≈õci ‚è≥ / Niesprawne ‚ùå]
‚îú‚îÄ‚îÄ Zdjƒôcia po naprawie: [Upload] (min. 1)
‚îî‚îÄ‚îÄ Czƒô≈õci u≈ºyte: [Lista z magazynu technika]
    ‚Üì
[Potwierd≈∫ zako≈Ñczenie] ‚Üí API aktualizuje status
```

**Zalety:**
- ‚úÖ Szybkie (2-3 klikniƒôcia)
- ‚úÖ Nie frustruje technik√≥w
- ‚úÖ Zbiera kluczowe info
- ‚úÖ Mo≈ºna zaimplementowaƒá w 2-3h

**Wady:**
- ‚ùå Brak podpisu klienta
- ‚ùå Brak szczeg√≥≈Çowej kalkulacji

---

### **Opcja B: Pe≈Çny Protok√≥≈Ç (dla firm wymagajƒÖcych dokumentacji)**

#### Co dodaƒá:
1. **Multi-step completion wizard** (3 kroki)
2. **Wymagana kompletno≈õƒá:**
   - Diagnoza (je≈õli to by≈Ça diagnoza)
   - Lista wykonanych czynno≈õci
   - Lista u≈ºytych czƒô≈õci
   - Zdjƒôcia "przed" i "po"
   - Pomiary/testy
   - Koszty (robocizna + czƒô≈õci)
   - Podpis klienta (Canvas signature)

#### Przep≈Çyw:
```
[Przycisk "Zako≈Ñcz wizytƒô"]
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Krok 1/3: Wykonane prace        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚òë Diagnoza wykonana             ‚îÇ
‚îÇ ‚òë Naprawa wykonana              ‚îÇ
‚îÇ ‚òë Wymiana czƒô≈õci                ‚îÇ
‚îÇ ‚òë Czyszczenie                   ‚îÇ
‚îÇ ‚òë Testy dzia≈Çania               ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ Opis szczeg√≥≈Çowy: [Textarea]   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Krok 2/3: Czƒô≈õci i koszty       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ U≈ºyte czƒô≈õci:                   ‚îÇ
‚îÇ [+] Dodaj czƒô≈õƒá z magazynu      ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ Robocizna: __ minut √ó __z≈Ç      ‚îÇ
‚îÇ Dojazd: __ km √ó __z≈Ç            ‚îÇ
‚îÇ Czƒô≈õci: __z≈Ç                    ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÇ
‚îÇ RAZEM: __z≈Ç                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Krok 3/3: Dokumentacja          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Zdjƒôcia "po": [Upload] (min. 2) ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ Status urzƒÖdzenia:              ‚îÇ
‚îÇ ‚óã Sprawne                       ‚îÇ
‚îÇ ‚óã Wymaga dodatkowej wizyty      ‚îÇ
‚îÇ ‚óã Niesprawne (brak czƒô≈õci)      ‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ Podpis klienta: [Canvas]        ‚îÇ
‚îÇ (opcjonalny)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
[Wygeneruj protok√≥≈Ç PDF] ‚Üí [Zako≈Ñcz wizytƒô]
```

**Zalety:**
- ‚úÖ Pe≈Çna dokumentacja
- ‚úÖ Protok√≥≈Ç PDF dla klienta
- ‚úÖ Dok≈Çadne rozliczenie
- ‚úÖ Prawnie bezpieczne

**Wady:**
- ‚ùå Czasoch≈Çonne (5-10 minut)
- ‚ùå Mo≈ºe frustrowaƒá technik√≥w
- ‚ùå Wiƒôcej do zakodowania (1-2 dni)

---

### **Opcja C: Hybrydowa (OPTIMAL dla wiƒôkszo≈õci) üåü**

**Szybka ≈õcie≈ºka + opcjonalny szczeg√≥≈Ç**

#### Przep≈Çyw:
```
[Przycisk "Zako≈Ñcz wizytƒô"]
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö° Szybkie zako≈Ñczenie           ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÇ
‚îÇ Co zrobiono? [Textarea]          ‚îÇ
‚îÇ Status: [‚úÖ Sprawne]             ‚îÇ
‚îÇ Zdjƒôcia: [Upload min. 1]         ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ [Zako≈Ñcz szybko] ‚Üê 2-3 klikniƒôcia‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ lub                              ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ [üìã Pe≈Çny protok√≥≈Ç] ‚Üí Full form ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Quick mode:**
- Tylko najwa≈ºniejsze: notatka + zdjƒôcie + status
- 30 sekund

**Full mode:**
- Dla skomplikowanych napraw
- Gdy potrzebny dok≈Çadny protok√≥≈Ç
- Gdy u≈ºyto wielu czƒô≈õci

**Zalety:**
- ‚úÖ Elastyczno≈õƒá
- ‚úÖ Nie blokuje szybkich wizyt
- ‚úÖ Opcja szczeg√≥≈Ç√≥w gdy potrzeba
- ‚úÖ Best of both worlds

---

## üõ†Ô∏è Konkretny Plan Implementacji (Opcja A - RECOMMENDED)

### 1. **Nowy komponent: `VisitCompletionModal.js`**

```jsx
// components/technician/VisitCompletionModal.js

import { useState } from 'react';
import PhotoUploader from './PhotoUploader';

export default function VisitCompletionModal({ visit, onComplete, onCancel }) {
  const [summary, setSummary] = useState('');
  const [deviceStatus, setDeviceStatus] = useState('working'); // working | needs_parts | broken
  const [afterPhotos, setAfterPhotos] = useState([]);
  const [usedParts, setUsedParts] = useState([]);
  const [loading, setLoading] = useState(false);

  const handleComplete = async () => {
    // Walidacja
    if (!summary.trim()) {
      alert('Opisz kr√≥tko co zosta≈Ço zrobione');
      return;
    }

    if (afterPhotos.length === 0) {
      alert('Dodaj przynajmniej jedno zdjƒôcie po naprawie');
      return;
    }

    setLoading(true);

    try {
      // 1. Zapisz podsumowanie
      await fetch(`/api/technician/visits/${visit.visitId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('technicianToken')}`
        },
        body: JSON.stringify({
          completionSummary: summary,
          deviceStatus: deviceStatus,
          afterPhotos: afterPhotos,
          usedParts: usedParts
        })
      });

      // 2. Zmie≈Ñ status na completed
      await fetch('/api/technician/update-status', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('technicianToken')}`
        },
        body: JSON.stringify({
          visitId: visit.visitId,
          status: 'completed',
          notes: summary
        })
      });

      onComplete();
    } catch (error) {
      console.error('Error completing visit:', error);
      alert('B≈ÇƒÖd podczas ko≈Ñczenia wizyty');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
        {/* Header */}
        <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white p-6 rounded-t-xl">
          <h2 className="text-2xl font-bold flex items-center">
            ‚úÖ Zako≈Ñczenie wizyty
          </h2>
          <p className="text-green-100 text-sm mt-1">
            {visit.visitId} ‚Ä¢ {visit.client?.name}
          </p>
        </div>

        <div className="p-6 space-y-6">
          {/* 1. Co zosta≈Ço zrobione? */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              1. Co zosta≈Ço zrobione? *
            </label>
            <textarea
              value={summary}
              onChange={(e) => setSummary(e.target.value)}
              placeholder="np. Wymieniono pompƒô odp≈ÇywowƒÖ, wyczyszczono filtr, uruchomiono i przetestowano"
              rows={4}
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              required
            />
            <p className="text-xs text-gray-500 mt-1">
              Kr√≥tki opis wykonanej pracy (widoczny dla klienta i biura)
            </p>
          </div>

          {/* 2. Status urzƒÖdzenia */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-3">
              2. Status urzƒÖdzenia po naprawie *
            </label>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
              <button
                type="button"
                onClick={() => setDeviceStatus('working')}
                className={`p-4 rounded-lg border-2 transition-all ${
                  deviceStatus === 'working'
                    ? 'border-green-500 bg-green-50'
                    : 'border-gray-300 hover:border-green-300'
                }`}
              >
                <div className="text-3xl mb-2">‚úÖ</div>
                <div className="font-medium">Sprawne</div>
                <div className="text-xs text-gray-500">Dzia≈Ça poprawnie</div>
              </button>

              <button
                type="button"
                onClick={() => setDeviceStatus('needs_parts')}
                className={`p-4 rounded-lg border-2 transition-all ${
                  deviceStatus === 'needs_parts'
                    ? 'border-yellow-500 bg-yellow-50'
                    : 'border-gray-300 hover:border-yellow-300'
                }`}
              >
                <div className="text-3xl mb-2">‚è≥</div>
                <div className="font-medium">Wymaga czƒô≈õci</div>
                <div className="text-xs text-gray-500">Potrzebna kolejna wizyta</div>
              </button>

              <button
                type="button"
                onClick={() => setDeviceStatus('broken')}
                className={`p-4 rounded-lg border-2 transition-all ${
                  deviceStatus === 'broken'
                    ? 'border-red-500 bg-red-50'
                    : 'border-gray-300 hover:border-red-300'
                }`}
              >
                <div className="text-3xl mb-2">‚ùå</div>
                <div className="font-medium">Niesprawne</div>
                <div className="text-xs text-gray-500">Nie uda≈Ço siƒô naprawiƒá</div>
              </button>
            </div>
          </div>

          {/* 3. Zdjƒôcia po naprawie */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              3. Zdjƒôcia po naprawie * (min. 1)
            </label>
            <PhotoUploader
              visitId={visit.visitId}
              category="after"
              onPhotosUpdate={setAfterPhotos}
              maxPhotos={5}
              required={true}
            />
            <p className="text-xs text-gray-500 mt-2">
              üì∏ Zr√≥b zdjƒôcie urzƒÖdzenia dzia≈ÇajƒÖcego, wymienionych czƒô≈õci, ekranu testowego
            </p>
          </div>

          {/* 4. U≈ºyte czƒô≈õci (opcjonalne) */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              4. Czy u≈ºyto jakich≈õ czƒô≈õci? (opcjonalne)
            </label>
            <button
              type="button"
              onClick={() => {/* TODO: Modal wyboru czƒô≈õci z magazynu */}}
              className="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-all"
            >
              + Dodaj czƒô≈õƒá z magazynu
            </button>
            {usedParts.length > 0 && (
              <div className="mt-3 space-y-2">
                {usedParts.map((part, idx) => (
                  <div key={idx} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span className="font-medium">{part.name}</span>
                    <span className="text-sm text-gray-600">√ó{part.quantity}</span>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Podsumowanie */}
          <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
            <h4 className="font-semibold text-blue-900 mb-2">üìã Podsumowanie:</h4>
            <ul className="text-sm text-blue-800 space-y-1">
              <li>‚úÖ Opis pracy: {summary ? '‚úì' : '‚ùå Wymagane'}</li>
              <li>‚úÖ Status urzƒÖdzenia: {deviceStatus === 'working' ? 'Sprawne ‚úì' : deviceStatus === 'needs_parts' ? 'Wymaga czƒô≈õci ‚è≥' : 'Niesprawne ‚ùå'}</li>
              <li>‚úÖ Zdjƒôcia po: {afterPhotos.length > 0 ? `${afterPhotos.length} ‚úì` : '‚ùå Min. 1'}</li>
              <li>üì¶ U≈ºyte czƒô≈õci: {usedParts.length || 0}</li>
            </ul>
          </div>
        </div>

        {/* Footer Actions */}
        <div className="flex gap-3 p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl">
          <button
            type="button"
            onClick={onCancel}
            disabled={loading}
            className="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium disabled:opacity-50"
          >
            Anuluj
          </button>
          <button
            type="button"
            onClick={handleComplete}
            disabled={loading || !summary.trim() || afterPhotos.length === 0}
            className="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
          >
            {loading ? (
              <span className="flex items-center justify-center">
                <svg className="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                </svg>
                Ko≈Ñczƒô...
              </span>
            ) : (
              '‚úÖ Zako≈Ñcz wizytƒô'
            )}
          </button>
        </div>
      </div>
    </div>
  );
}
```

### 2. **Zmodyfikuj StatusControl.js**

```jsx
// W StatusControl.js, dodaj w miejscu gdzie pokazuje siƒô konfirmacja dla 'completed':

import VisitCompletionModal from './VisitCompletionModal';

// ... w komponencie:
const [showCompletionModal, setShowCompletionModal] = useState(false);

// Zmie≈Ñ handleStatusClick:
const handleStatusClick = (newStatus) => {
  if (newStatus === 'completed') {
    // Otw√≥rz modal zako≈Ñczenia zamiast prostej konfirmacji
    setShowCompletionModal(true);
  } else if (newStatus === 'cancelled') {
    setSelectedStatus(newStatus);
    setShowConfirmation(true);
  } else {
    updateStatus(newStatus, '');
  }
};

// Na ko≈Ñcu render dodaj:
{showCompletionModal && (
  <VisitCompletionModal
    visit={visit}
    onComplete={() => {
      setShowCompletionModal(false);
      loadVisitDetails(); // Od≈õwie≈º dane
    }}
    onCancel={() => setShowCompletionModal(false)}
  />
)}
```

### 3. **Rozszerz API endpoint** (opcjonalnie)

Dodaj walidacjƒô w `/api/technician/update-status.js`:

```javascript
// Przed zmianƒÖ statusu na 'completed', sprawd≈∫:
if (newStatus === 'completed') {
  // Sprawd≈∫ czy sƒÖ zdjƒôcia "after"
  const hasAfterPhotos = visit.photos?.some(p => p.category === 'after') || 
                          visit.afterPhotos?.length > 0;
  
  if (!hasAfterPhotos) {
    return {
      success: false,
      error: 'MISSING_PHOTOS',
      message: 'At least one "after" photo is required to complete the visit'
    };
  }
  
  // Sprawd≈∫ czy jest completion summary
  if (!visit.completionSummary && !notes) {
    return {
      success: false,
      error: 'MISSING_SUMMARY',
      message: 'Completion summary is required'
    };
  }
}
```

---

## üìä Por√≥wnanie opcji

| Feature | Opcja A (Quick) | Opcja B (Full) | Opcja C (Hybrid) |
|---------|----------------|----------------|------------------|
| Czas implementacji | 2-3h | 1-2 dni | 4-6h |
| Czas u≈ºycia (technik) | 30 sek | 5-10 min | 30 sek - 5 min |
| Frustration level | Niski ‚úÖ | Wysoki ‚ö†Ô∏è | Niski ‚úÖ |
| Dokumentacja | Podstawowa | Pe≈Çna | Elastyczna |
| Koszt kodu | Niski | Wysoki | ≈öredni |
| Recommended | ‚≠ê‚≠ê‚≠ê | ‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |

---

## üéØ Rekomendacja

**Zacznij od Opcji A**, ale z my≈õlƒÖ o przysz≈Çej rozbudowie do Opcji C.

### Implementacja stopniowa:

**Faza 1 (2-3h):**
- ‚úÖ Modal VisitCompletionModal
- ‚úÖ 4 pola: opis, status, zdjƒôcia, czƒô≈õci
- ‚úÖ Walidacja minimum (opis + 1 zdjƒôcie)

**Faza 2 (1-2h):**
- ‚úÖ Integracja z magazynem technika
- ‚úÖ Automatyczne rozliczenie czasu pracy
- ‚úÖ Preview podsumowania przed wys≈Çaniem

**Faza 3 (2-3h):**
- ‚úÖ Opcjonalny tryb "Pe≈Çny protok√≥≈Ç"
- ‚úÖ Generowanie PDF
- ‚úÖ Email do klienta z podsumowaniem

---

## üí° Dodatkowe pomys≈Çy

### 1. **Szablony zako≈Ñczenia**
```
"Wymieniono [czƒô≈õƒá] w [urzƒÖdzenie]. Przetestowano - dzia≈Ça poprawnie."
"Wyczyszczono filtr i pompƒô. Uruchomiono program testowy - bez b≈Çƒôd√≥w."
"Zdiagnozowano usterkƒô [X]. Potrzebna czƒô≈õƒá [Y]. Zam√≥wiono."
```

### 2. **Smart suggestions**
- AI podpowiada brakujƒÖce czƒô≈õci na podstawie opisu
- Automatyczne tagowanie problemu
- Sugerowane zdjƒôcia ("Zr√≥b zdjƒôcie ekranu z programem testowym")

### 3. **Offline support**
- Zapisz dane lokalnie je≈õli brak internetu
- Synchronizuj gdy wr√≥ci po≈ÇƒÖczenie

### 4. **Gamification**
- Punkty za kompletne dokumentacje
- Badge "Perfekcjonista" za 100% wype≈Çnione wizyty
- Ranking technik√≥w wed≈Çug jako≈õci dokumentacji

---

## üöÄ Quick Start

Chcesz, ≈ºebym zaimplementowa≈Ç **Opcjƒô A**? 

Mogƒô stworzyƒá:
1. ‚úÖ Komponent `VisitCompletionModal.js`
2. ‚úÖ Zmodyfikowaƒá `StatusControl.js`
3. ‚úÖ Rozszerzyƒá API
4. ‚úÖ Dodaƒá walidacjƒô

Potrzebujesz oko≈Ço **2-3 godzin** pracy, ale efekt bƒôdzie natychmiastowy! üéØ
